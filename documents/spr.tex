\documentclass[]{article}
\usepackage{tikz}
\usetikzlibrary{shapes,arrows}
\tikzstyle{line} = [draw]
\usepackage{lmodern}
\usepackage{amssymb,amsmath}
\usepackage{ifxetex,ifluatex}
\usepackage{fixltx2e} % provides \textsubscript
\ifnum 0\ifxetex 1\fi\ifluatex 1\fi=0 % if pdftex
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
\else % if luatex or xelatex
  \ifxetex
    \usepackage{mathspec}
  \else
    \usepackage{fontspec}
  \fi
  \defaultfontfeatures{Ligatures=TeX,Scale=MatchLowercase}
\fi
% use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
% use microtype if available
\IfFileExists{microtype.sty}{%
\usepackage[]{microtype}
\UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}
\PassOptionsToPackage{hyphens}{url} % url is loaded by hyperref
\usepackage[unicode=true]{hyperref}
\hypersetup{
            pdftitle={Generacja grafu i odnalezienie najkrótszej ścieżki pomiędzy węzłami: graph},
            pdfauthor={Ulyana Petrashevich, Inga Maziarz}
            pdfborder={0 0 0},
            breaklinks=true}
\urlstyle{same}  % don't use monospace font for urls
\IfFileExists{parskip.sty}{%
\usepackage{parskip}
}{% else
\setlength{\parindent}{0pt}
\setlength{\parskip}{6pt plus 2pt minus 1pt}
}
\setlength{\emergencystretch}{3em}  % prevent overfull lines
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
\setcounter{secnumdepth}{0}
% Redefines (sub)paragraphs to behave more like sections
\ifx\paragraph\undefined\else
\let\oldparagraph\paragraph
\renewcommand{\paragraph}[1]{\oldparagraph{#1}\mbox{}}
\fi
\ifx\subparagraph\undefined\else
\let\oldsubparagraph\subparagraph
\renewcommand{\subparagraph}[1]{\oldsubparagraph{#1}\mbox{}}
\fi

% set default figure placement to htbp
\makeatletter
\def\fps@figure{htbp}
\makeatother


\title{\texttt{Sprawozdanie końcowe}\\Generacja grafu i odnalezienie najkrótszej ścieżki pomiędzy węzłami - \texttt{graph}}
\author{Ulyana Petrashevich, Inga Maziarz}
\date{02.04.2022}

\begin{document}
\maketitle

\section{Opis teoretyczny zagadnienia}\label{header-n231}
Program \texttt{graph} służy do wyszukiwania najkrótszej ścieżki w grafie ważonym nieskierowanym. Program zawiera funkcje wczytującą i wypisującą graf z/do pliku oraz generator grafu spójnego i niespójnego. Za wyszukiwanie najkrótszej ścieżki odpowiedzialne są funkcje \texttt{bfs} oraz \texttt{dijkstra}. \texttt{BFS}, czyli algorytm przeszukiwania wszerz, działa następująco: 
\begin{itemize}
\item
  Węzeł początkowy oznaczany jest jako odwiedzony. Do kolejki dodawane są sąsiadujące z nim węzły (w kolejności od węzła z najmniejszym indeksem).
\item
  Odwiedzony zostaje następny węzeł w kolejce. Postępowanie jest analogiczne do wcześniejszego; do kolejki zostają dodane węzły sąsiadujące z obecnym, jednak tylko te, które nie zostały odwiedzone wcześniej.
  
\item
  Proces jest powtarzany aż do momentu odwiedzenia wszystkich węzłów z kolejki. Jeżeli na końcu wszystkie węzły w grafie zostały odwiedzone, oznacza to, że przeszukiwany graf jest spójny. 
\end{itemize}
Jeżeli \texttt{bfs} zwróci wartość oznaczającą spójność grafu, to program przechodzi do kolejnego kroku, którym jest znalezienie najkrótszej ścieżki algorytmem Dijkstry, który działa w poniższy sposób:
\begin{itemize}
\item
Długości przy węźle początkowym otrzymują wartość 0. Długość ścieżki do każdego innego węzła zostaje ustawiona na nieskończoność. 
\item
  Oznaczamy węzeł początkowy jako odwiedzony. Dla każdego jego sąsiada zostaje przypisana długość równa wadze krawędzi między nimi. 
\item
  Nieodwiedzony węzeł o najmniejszej przypisanej długości zostaje oznaczony jako odwiedzony. Dla każdego jego sąsiada zostaje obliczona wartość równa sumie długości przy obecnym węźle i wagi krawędzi między nimi. Jeżeli znaleziona wartość jest mniejsza niż przypisana do sąsiada, to zostaje ona zamieniona. 
\item
  Poprzedni krok jest powtarzany aż do odwiedzenia wszystkich węzłów. Ostatecznie każdy węzeł (w tym wybrany jako końcowy) ma przypisaną długość najkrótszej ścieżki od węzła początkowego. Zapamiętana ścieżka może zostać wypisana na ekran.
\end{itemize}

\section{Opis wywołania}\label{header-n233}
Program \texttt{graph} akceptuje następujące argumenty wywołania:

\begin{itemize}
\item
  \texttt{-{}-file\ filename} nazwa pliku z danymi;
\item
  \texttt{-{}-from\ k} podawany jest numer węzła początkowego w ścieżce; domyślnie \texttt{k\ =\ 0};
\item
  \texttt{-{}-to\ l} podawany jest numer węzła końcowego w ścieżce; domyślnie \texttt{l\ =\ maksymalny numer w grafie};
\item
  \texttt{-{}-output\ filename} nazwa pliku, w który będzie zapisywana ścieżka; domyślnie \texttt{stdout};
\item
  \texttt{-{}-grow\ n} określa liczbę wierszy generowanego grafu; domyślnie \texttt{n\ =\ 10};
\item
  \texttt{-{}-gcol\ m} określa liczbę kolumn w generowanym grafie; domyślnie \texttt{m\ =\ 10};
\item
  \texttt{-{}-gfrom\ x} przyjmuje granicę dolną zakresu wartości losowanych wag, domyślnie \texttt{x\ =\ 0.01};
\item
  \texttt{-{}-gto\ y} przyjmuje granicę górną zakresu wartości losowanych wag, domyślnie \texttt{y\ =\ 10.0};
\item
  \texttt{-{}-gconnect\ s} przyjmuje flagę na spójność generowanego grafa. 0 - graf niespójny, 1 - graf spójny, 2 - graf losowy;
\item
  \texttt{-{}-goutput\ filename} nazwa pliku, w którym będą zapisane parametry wygenerowanego grafu, domyślnie \texttt{stdout}.
\end{itemize}
Dla uruchomienia algorytmu znajdowania ścieżki wystarczy podać chociażby jeden parametr z nią związany, t.j. nazwa pliku z danymi, numer węzła początkowego, numer węzła końcowego i plik wyjściowy do ścieżki. Przy niepodaniu parametru program ustali wartość domyślną lub wygeneruje graf w przypadku niepodania nazwy pliku z danymi.

Sześć końcowych parametrów odpowiadają za właściwości generowanego grafu, jak osobno od modułu odnalezienia ścieżki, tak i wewnątrz go.

Przy niepodaniu żadnych argumentów program wygeneruje graf, oparty na wartościach domyślnych.

Obowiązkowe właściwości podanego grafu:

Program będzie sprawdzał, czy graf odpowiada następnym właściwościom:
\begin{itemize}
    \item \texttt{Graf musi mieć postać „grafu-kratki”. }
    
To znaczy, że po przedstawieniu grafu w postaci graficznej, jego wierzchołki mogą być złączone krawędzią tylko z wierzchołkami sąsiednimi w osi poziomej i pionowej. Przykład:

0 – 1

|\, \, \, \,|

2 – 3  

Między wierzchołkiem 0 a 3 krawędzi być nie może.
    \item \texttt{Graf musi być spójny.}

To znaczy, że od każdego wierzchołka grafu istnieje ścieżka do każdego innego wierzchołka.

\end{itemize}

\subsection{Widok pliku}
Program jest uczulony na podanie danych w nieprawidłowym formacie. Może to skutkować niepoprawnym traktowaniem danych, aż do napotkania błędów, skutkujących przerwaniem działania programu. 

Schemat poprawnego formatu danych:

Pierwszą linijkę zajmują dwie liczby: liczba wierszy i liczba kolumn, oddzielone od siebie minimum jedną spacją.

Zaczynając od drugiej linijki, podawane są krawędzie i ich wagi. Numer wierzchołka, od którego zaczyna się krawędź jest równy (numerowi linijki - 2), np. w 2. W tej linijce, tuż po rozmiarach grafu, będą opisane krawędzie prowadzące do wierzchołka 0. Pierwsze dane o krawędzi muszą być podane, odstąpiwszy od początku linijki minimum jedną tabulację lub spację. Między numerem drugiego wierzchołka, złączonego krawędzią, a jej wagą musi być napisany chociażby jeden znak niepusty, np (:). Separatorem dziesiętnym wagi musi być kropka(.). Między dwoma krawędziami muszą być dwie lub więcej spacji. Tuż po ostatniej krawędzi, odnoszącej się do danego wierzchołka, przechodzimy na nową linijkę.

Nie ma potrzeby podawać wagi dwa razy symetrycznie, np. od 0 do 1 i od 1 do 0 – program duplikuje jedną z podanych wag przy wczytaniu.

Jeżeli do wierzchołka nie chcemy przypisywać żadnych krawędzi, pozostawiamy odpowiednią linijkę pustą – bez tabulacji, spacji lub innych znaków.

Przykład poprawnej formy danych:
\begin{verbatim}
2 2
    2 :2.76543  1 :4.56134

    1 :4.567345
    2 :6.47586
\end{verbatim}
W powyższym przykładzie wierzchołek numer 1 nie ma przypisanych krawędzi (choć będzie je miał po zduplikowaniu krawędzi od wierzchołków 0 i 2).
\section{Testy}\label{header-n233}

W pliku Makefile znajdują się wywołania testów programów pod nazwami „test1”, „test2” itd. Testy, związane tylko z generatorem grafu, nazywają się „testg1” itd. Dodatkowo dodany test „help”, pokazujący zachowanie programu przy podaniu nieprawidłowych opcji.

Testy, których nie da się zaimplementować do Makefile, to testy związane z poprawnością danych w pliku. Takie testy przeprowadziłyśmy ręcznie.

\begin{enumerate}
    \item Dane wejściowe: \texttt{./graph -{}-file dane.txt -{}-from 0 -{}-to 3 -{}-output sciezka.txt}
    
Plik \texttt{dane.txt} zawiera:
\begin{verbatim}
2 2
    1 :-5.74  2 :3.21
    3 :10.21
    3 :1.74
\end{verbatim}
Na wyjściu otrzymujemy komunikat \texttt{„ Waga krawędzi między węzłem 0 i 1 jest ujemna, równa -5.740000. Ustawiam wartość 5.740000.”}, przekazany na \texttt{stdout} i plik \texttt{sciezka.txt}, zawierający:
\begin{verbatim}
Najkrótsza ścieżka: 
0 -3.210000- 2 -1.740000- 3
Długość ścieżki równa 4.950000
\end{verbatim}
    \item Dane wejściowe: \texttt{./graph -{}-file dane.txt -{}-output sciezka.txt}

Plik \texttt{dane.txt} zawiera:
\begin{verbatim}
Nie graf!
\end{verbatim}
Na wyjściu otrzymujemy komunikat \texttt{”Błędny format pliku z grafem. Przerywam działanie.”}, przekazany na \texttt{stderr}.

    \item Dane wejściowe: \texttt{./graph -{}-file blednygraf.txt}
    
Plik \texttt{blednygraf.txt} zawiera:
\begin{verbatim}
2 3
        1 :1.0  4 :8.0
        0 :1.0  2 :3.0  4 :6.0
        1 :3.0  5 :7.0

        1 :6.0  5 :2.0  0 :8.0
        2 :7.0  4 :2.0
\end{verbatim}
Powyższy plik jest opisem poniższego grafu:
\begin{figure}[-h!]
\centering
  \begin{tikzpicture}[node distance = 2cm, auto]
  \node [circle, draw, text centered] (zero) {\large \textbf{0}};
    \node [circle, draw, text centered, right of = zero] (one) {\large \textbf{1}};
      \node [circle, draw, text centered, right of = one] (two) {\large \textbf{2}};
        \node [circle, draw, text centered, below of = zero] (three) {\large \textbf{3}};
          \node [circle, draw, text centered, below of = one] (four) {\large \textbf{4}};
            \node [circle, draw, text centered, below of = two] (five) {\large \textbf{5}};
            
                \path [line] (zero) -- node{\small 1}(one);
                \path [line] (one) -- node{\small 3}(two);
                \path [line] (one) -- node{\small 6}(four);
                \path [line] (two) -- node{\small 7}(five);
                \path [line] (four) -- node{\small 2}(five);
                \path [line] (zero) -- node{\small 8}(four);
    \end{tikzpicture}
\end{figure}
\newline
Zgodnie z założeniem poprawności grafu, krawędzie mogą istnieć tylko między sąsiadującymi węzłami. Program wykrywa tę niepoprawność i wypisuje komunikat:
\begin{verbatim}
    Błędny format pliku z grafem. Między węzłem 0 a 4 
    nie może istnieć połączenie. Przerywam działanie.
\end{verbatim}

\end{enumerate}

\section{Błędy i wnioski}\label{header-n233}
Podczas pisania programu problemem okazało się niedoprecyzowanie wymagań dotyczących budowy grafu. Plik testowy \texttt{mygraph} o poniższej zawartości (tu widoczne pierwszych kilka linii pliku)
\begin{verbatim}
7 4
	 1 :0.8864916775696521  4 :0.2187532451857941 
	 5 :0.2637754478952221  2 :0.6445273453144537  0 :0.4630166785185348 
	 6 :0.8650384424149676  3 :0.42932761976709255  1 :0.6024952385895536 
	 7 :0.5702072705027322  2 :0.86456124269257 
	 8 :0.9452864187437506  0 :0.8961825862332892  5 :0.9299058855442358 
	 ...
	 \end{verbatim}
sugerował, że przyjmowany graf powinien być skierowany. Program \texttt{graph} obsługuje jednak tylko grafy nieskierowane, więc ten problem został zlikwidowany poprzez przekształcenie grafu skierowanego w nieskierowany dzięki duplikacji wag pomiędzy konkretnymi węzłami. Wczytując plik za pomocą funkcji \texttt{read\_graph}, a następnie wypisując go przy użyciu \texttt{write\_graph} otrzymujemy już odpowiedni graf: 
\bigskip
\begin{verbatim}
7 4
	1 :0.463017 4 :0.896183 
	0 :0.463017 2 :0.602495 5 :0.595644 
	1 :0.602495 3 :0.864561 6 :0.200570 
	2 :0.864561 7 :0.797053 
	0 :0.896183 5 :0.449257 8 :0.750068
	...
\end{verbatim}
\end{document}
